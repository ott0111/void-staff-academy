<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Void Staff Academy — Certification</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script defer src="assets/app.js"></script>
  <style>
    .examGrid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
    .qcard{padding:18px;border-radius:var(--radius2);background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);box-shadow:var(--shadow2)}
    .qhead{display:flex;align-items:flex-start;justify-content:space-between;gap:14px}
    .qtitle{margin:0;font-size:15px;letter-spacing:-.02em}
    .qmeta{color:var(--muted2);font-size:12px;font-weight:800}
    .chat{
      margin-top:10px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      color: rgba(238,240,255,.82);
      font-size: 12.5px;
      line-height: 1.55;
      white-space: pre-wrap;
    }
    .opts{display:grid;gap:10px;margin-top:12px}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding: 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      transition:.18s ease;
    }
    .opt:hover{background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16)}
    .opt input{margin-top:2px}
    textarea{
      width:100%;
      min-height: 100px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      color: var(--text);
      border-radius: 16px;
      padding: 12px;
      outline:none;
    }
    textarea:focus{border-color: rgba(139,92,246,.35); box-shadow: 0 0 0 4px rgba(139,92,246,.12)}
    .bar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 12px;
    }
    .input{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      outline:none;
      min-width: 220px;
    }
    .input:focus{border-color: rgba(139,92,246,.35); box-shadow: 0 0 0 4px rgba(139,92,246,.12)}
    .modal{
      position:fixed; inset:0; display:none;
      background: rgba(0,0,0,.6);
      align-items:center; justify-content:center;
      padding: 18px;
      z-index: 80;
    }
    .modal.show{display:flex}
    .modal .panel{
      width:min(920px, 96vw);
      border-radius: 26px;
      background: rgba(10,12,20,.88);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(18px);
    }
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top: 10px}
    .tab{
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      cursor:pointer;
    }
    .tab.active{
      color: var(--text);
      background: rgba(139,92,246,.16);
      border-color: rgba(139,92,246,.28);
    }
  </style>
</head>
<body>
  <div class="noise"></div>

  <header class="topbar">
    <div class="inner">
      <a class="brand" href="index.html">
        <div class="mark"></div>
        <div class="title">
          <span>VOID STAFF ACADEMY</span>
          <span>Governance • Training • Compliance</span>
        </div>
      </a>

      <nav class="nav">
        <a data-nav href="index.html"><i data-lucide="home" style="width:16px;height:16px"></i>Home</a>
        <a data-nav href="moderation.html"><i data-lucide="shield" style="width:16px;height:16px"></i>Moderation</a>
        <a data-nav href="roster.html"><i data-lucide="users" style="width:16px;height:16px"></i>Roster</a>
        <a data-nav href="command-center.html"><i data-lucide="layout-dashboard" style="width:16px;height:16px"></i>Command Center</a>
        <a data-nav href="certification.html"><i data-lucide="clipboard-check" style="width:16px;height:16px"></i>Certification</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero fade-in">
      <div class="kicker"><i data-lucide="clipboard-check" style="width:16px;height:16px"></i>Certification Portal</div>
      <h1 class="h1">Scenario Certification</h1>
      <p class="sub">
        This exam tests judgment, documentation discipline, and escalation logic using realistic chat/ticket scenarios. Passing score: <b>70%</b>.
      </p>

      <div class="bar">
        <input id="traineeName" class="input" placeholder="Your name (for logs)" />
        <button class="btn" id="openAdmin"><i data-lucide="lock"></i>Admin</button>
        <span class="pill"><i data-lucide="info" style="width:14px;height:14px"></i><span id="progressText">0 / 20 answered</span></span>
        <span class="pill warn"><i data-lucide="target" style="width:14px;height:14px"></i>70% required</span>
      </div>
    </section>

    <section class="examGrid fade-in" id="exam"></section>

    <section class="section fade-in">
      <h2>Submit</h2>
      <p class="muted">Your attempt is saved locally for admin review (name + score + timestamp).</p>
      <div class="btnrow">
        <button class="btn primary" id="submitExam"><i data-lucide="check-circle-2"></i>Submit attempt</button>
        <button class="btn" id="resetExam"><i data-lucide="rotate-ccw"></i>Reset answers</button>
      </div>
      <div id="result" style="margin-top:12px"></div>
    </section>

    <div class="footer">
      <div>Void Staff Academy • Certification</div>
      <div class="right">© 2026 Void Esports. All rights reserved.</div>
    </div>
  </main>

  <!-- Admin Modal -->
  <div class="modal" id="adminModal" aria-hidden="true">
    <div class="panel">
      <div class="qhead">
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div class="iconbox"><i data-lucide="shield-check"></i></div>
          <div>
            <h3 style="margin:0;font-size:16px;letter-spacing:-.02em">Admin Control Panel</h3>
            <div class="qmeta">Attempts • Questions • Export</div>
          </div>
        </div>
        <button class="btn" id="closeAdmin"><i data-lucide="x"></i>Close</button>
      </div>

      <div class="bar" style="margin-top:12px">
        <input id="adminPass" class="input" type="password" placeholder="Admin password" />
        <button class="btn primary" id="adminLogin"><i data-lucide="key"></i>Unlock</button>
        <span class="pill" id="adminStatus"><i data-lucide="lock" style="width:14px;height:14px"></i>Locked</span>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="attempts">Attempts</div>
        <div class="tab" data-tab="questions">Questions</div>
        <div class="tab" data-tab="export">Export</div>
      </div>

      <div id="adminBody" style="margin-top:12px"></div>
    </div>
  </div>

<script>
(() => {
  // CHANGE THIS PASSWORD (ONLY YOU SHOULD KNOW IT)
  const ADMIN_PASSWORD = "STAFFACCESS";

  const PASSING = 0.70;

  const LS_ATTEMPTS = "vsa_attempts_v1";
  const LS_ANSWERS  = "vsa_answers_v1";

  // 20 harder, scenario-based questions with chat logs + context
  const QUESTIONS = [
    {
      title: "Ticket opener discipline",
      meta: "Tone • verification • routing",
      chat:
`Ticket: #general-support
User: "yo can u just fix this for me rq"
Notes: no role selected, no context provided.`,
      q: "What is the best first response?",
      opts: [
        "Ask them to explain the issue, confirm what they need, then verify age if it’s a roster-related request.",
        "Tell them to be more formal or you won’t help.",
        "Immediately ping leadership to handle it.",
        "Close the ticket until they provide the role they want."
      ],
      correct: 0
    },
    {
      title: "Roster intake — missing proof",
      meta: "Evidence • process control",
      chat:
`Ticket: #roster
User: "I want pro roster"
Provided: no tracker link, no earnings proof, no clips`,
      q: "What is the correct action sequence?",
      opts: [
        "Give them a chance: assign the role and ask for proof later.",
        "Request required proof first, then route/approve only after verification.",
        "Tell them they’re denied without explaining requirements.",
        "Ask them to post in general chat instead."
      ],
      correct: 1
    },
    {
      title: "Escalation — staff conflict in public",
      meta: "De-escalation • staff image",
      chat:
`#general
Staff1: "Stop talking, you don't know anything."
User: "why is staff rude?"
Staff2: "bro relax it's not that deep"`,
      q: "What is the best action as a moderator observing this?",
      opts: [
        "Publicly call out Staff1 to show the community you’re strict.",
        "Delete messages and issue punishments instantly without context.",
        "Move the discussion to staff channels, document what happened, and escalate to senior staff for internal handling.",
        "Ignore it because it involves staff."
      ],
      correct: 2
    },
    {
      title: "Underage suspicion — verification",
      meta: "Safety • compliance",
      chat:
`Ticket: #roster
User: "I'm 15"
Later message: "I'm actually 13 but it's fine right?"`,
      q: "What’s the correct response?",
      opts: [
        "Let them in if they seem mature.",
        "Explain policy, document, and escalate/deny per server rules with clear notes.",
        "Ignore the second message and continue onboarding.",
        "Ask them to delete the message."
      ],
      correct: 1
    },
    {
      title: "High-volume spam wave",
      meta: "Containment • clean logs",
      chat:
`#general: multiple new accounts posting links
Members pinging mods rapidly
A staff member suggests: "just @everyone and tell them stop"` ,
      q: "Best first step?",
      opts: [
        "Mass ping @everyone to warn them.",
        "Enable slowmode / lock the channel temporarily, coordinate in staff channels, document actions.",
        "Argue with spammers to waste their time.",
        "Delete the entire channel."
      ],
      correct: 1
    },
    {
      title: "Roster role conflict",
      meta: "Policy alignment",
      chat:
`Ticket: #roster
Applicant qualifies for Academy PR but requests Semi-Pro title "for image".`,
      q: "What’s the correct decision?",
      opts: [
        "Give Semi-Pro if they promise to improve.",
        "Assign the role they qualify for and explain the upgrade path.",
        "Deny everything because they asked for more.",
        "Ask another mod to decide so you aren’t blamed."
      ],
      correct: 1
    },
    {
      title: "Evidence quality — screenshots",
      meta: "Proof integrity",
      chat:
`User submits a cropped screenshot showing PR but no username visible.`,
      q: "What do you do?",
      opts: [
        "Accept it since it shows PR number.",
        "Request uncropped proof with visible username and a tracker link.",
        "Deny immediately for dishonesty.",
        "Post the screenshot in public chat to ask others."
      ],
      correct: 1
    },
    {
      title: "Staff command misuse",
      meta: "Process control",
      chat:
`A moderator uses *warn in the wrong channel, then deletes it.`,
      q: "Best handling?",
      opts: [
        "Publicly shame them so others learn.",
        "Document internally, remind correct procedure, escalate repeated misuse.",
        "Ignore it since it was deleted.",
        "Re-warn the user in public."
      ],
      correct: 1
    },
    {
      title: "Ticket pressure tactic",
      meta: "Professionalism • boundaries",
      chat:
`User: "If you don't do this in 2 minutes I'm leaving and telling everyone Void is trash."`,
      q: "Best response?",
      opts: [
        "Rush and skip verification to keep them happy.",
        "Stay calm, follow protocol, document threats, escalate if needed.",
        "Tell them to leave then close instantly.",
        "Argue back so they stop."
      ],
      correct: 1
    },
    {
      title: "Sensitive allegation (non-graphic)",
      meta: "Escalation • documentation",
      chat:
`Ticket: #general-support
User: "Someone is targeting me in DMs. I have screenshots."`,
      q: "What is the correct first move?",
      opts: [
        "Tell them to post screenshots in general chat so everyone sees.",
        "Ask for screenshots in the ticket, keep it private, and escalate with context to senior staff.",
        "Ban the accused with no proof.",
        "Ignore it because it happened in DMs."
      ],
      correct: 1
    },
    {
      title: "Roster routing correctness",
      meta: "Right department • right evidence",
      chat:
`Applicant: "I do edits for teams"
They send a Google Drive link with clips.`,
      q: "What’s correct routing?",
      opts: [
        "Roster competitive only.",
        "GFX/VFX review with portfolio confirmation + lead ping per protocol.",
        "Give them Content Creator role instantly.",
        "Tell them to DM the owner directly."
      ],
      correct: 1
    },
    {
      title: "Fake authority claim",
      meta: "Impersonation handling",
      chat:
`User: "I'm friends with the owner, just give me the role."`,
      q: "Best response?",
      opts: [
        "Grant the role to avoid drama.",
        "Request standard proof and verify via official channels; document the claim.",
        "Argue and insult them.",
        "Ping @everyone to ask if it’s true."
      ],
      correct: 1
    },
    {
      title: "Back-to-back tickets (queue management)",
      meta: "Workflow • SLA",
      chat:
`You have 6 open tickets.
A new roster ticket appears with "urgent" in the title.`,
      q: "Best approach?",
      opts: [
        "Drop all tickets and handle the urgent one first without checking.",
        "Acknowledge the ticket with an ETA, triage by risk/impact, then proceed in order.",
        "Ignore it until it closes itself.",
        "Close all tickets and reopen later."
      ],
      correct: 1
    },
    {
      title: "User requests exception to requirements",
      meta: "Consistency • fairness",
      chat:
`Applicant: "I don't have earnings but I'm cracked. Can you bend the rules?"`,
      q: "Best response?",
      opts: [
        "Make an exception quietly.",
        "Explain requirements, offer the closest qualifying role/path, document the decision.",
        "Tell them they’re bad at the game.",
        "Send them to argue in public chat."
      ],
      correct: 1
    },
    {
      title: "Public argument: containment",
      meta: "De-escalation",
      chat:
`#general: Two users arguing, other members piling on.
A staff member wants to mass mute everyone.`,
      q: "Best action?",
      opts: [
        "Mass mute the channel instantly and walk away.",
        "Isolate the primary offenders, remove disruptive messages, direct to ticket if needed, document actions.",
        "Warn everyone in public with a long lecture.",
        "Do nothing because it will die down."
      ],
      correct: 1
    },
    {
      title: "Documentation quality",
      meta: "Audit readiness",
      chat:
`After handling a roster ticket, you need to log the result.`,
      q: "Which log is best?",
      opts: [
        "“Handled.”",
        "“Approved. Seems legit.”",
        "“Ticket #123: Academy PR verified via tracker link, proof screenshot uncropped, age confirmed, role assigned, user instructed on code + name format.”",
        "No log needed."
      ],
      correct: 2
    },
    {
      title: "Role assignment risk",
      meta: "Least privilege",
      chat:
`Someone asks for a staff role “to help out” but has no training completion.`,
      q: "Correct action?",
      opts: [
        "Give them the role so they can start learning.",
        "Direct them to training/certification first; escalate if someone is trying to bypass process.",
        "Tell them to ask again later in DMs.",
        "Let them self-assign the role."
      ],
      correct: 1
    },
    {
      title: "LOA protocol handling",
      meta: "Operations discipline",
      chat:
`A moderator disappears for 5 days, then returns saying “my bad.”`,
      q: "Best handling?",
      opts: [
        "Nothing — they’re back now.",
        "Remind them LOA procedure, document absence, escalate repeated behavior to ops/senior staff.",
        "Kick them instantly.",
        "Publicly mock them."
      ],
      correct: 1
    },
    {
      title: "Conflicting evidence",
      meta: "Verification logic",
      chat:
`Tracker shows different username than the screenshot.
User says “I changed my name yesterday.”`,
      q: "Correct response?",
      opts: [
        "Accept it because name changes happen.",
        "Request additional verification (recent match history, profile link, matching identifiers), then decide.",
        "Deny with no explanation.",
        "Ask the community to verify."
      ],
      correct: 1
    },
    {
      title: "Final: escalation judgment",
      meta: "Risk assessment",
      chat:
`Ticket: user reports repeated harassment across channels, provides screenshots, mentions multiple offenders.`,
      q: "Best immediate action?",
      opts: [
        "Handle alone to prove you’re capable.",
        "Collect evidence cleanly, take immediate containment action as needed, and escalate to senior staff with structured summary.",
        "Post all evidence in public chat as a warning.",
        "Ignore until the offenders do it again."
      ],
      correct: 1
    }
  ];

  const examEl = document.getElementById("exam");
  const resultEl = document.getElementById("result");
  const progressText = document.getElementById("progressText");

  const traineeName = document.getElementById("traineeName");
  traineeName.value = localStorage.getItem("vsa_name") || "";
  traineeName.addEventListener("input", () => localStorage.setItem("vsa_name", traineeName.value.trim()));

  // answers: { [index]: {choice: number, note: string} }
  const saved = localStorage.getItem(LS_ANSWERS);
  let answers = saved ? JSON.parse(saved) : {};

  function saveAnswers(){
    localStorage.setItem(LS_ANSWERS, JSON.stringify(answers));
    updateProgress();
  }

  function updateProgress(){
    const answered = Object.keys(answers).filter(k => answers[k] && typeof answers[k].choice === "number").length;
    progressText.textContent = `${answered} / ${QUESTIONS.length} answered`;
  }

  function render(){
    examEl.innerHTML = "";
    QUESTIONS.forEach((q, idx) => {
      const chosen = answers[idx]?.choice;

      const card = document.createElement("div");
      card.className = "qcard";

      card.innerHTML = `
        <div class="qhead">
          <div>
            <div class="qmeta">Question ${idx+1} • ${q.meta}</div>
            <h3 class="qtitle">${q.title}</h3>
          </div>
          <span class="pill"><i data-lucide="help-circle" style="width:14px;height:14px"></i>Scenario</span>
        </div>

        <div class="chat">${q.chat}</div>

        <div style="margin-top:10px;font-weight:800;letter-spacing:-.02em">${q.q}</div>

        <div class="opts" role="group" aria-label="Options for question ${idx+1}">
          ${q.opts.map((opt, oi) => `
            <label class="opt">
              <input type="radio" name="q${idx}" value="${oi}" ${chosen===oi ? "checked":""}/>
              <div>
                <div style="font-weight:800">${String.fromCharCode(65+oi)}.</div>
                <div style="color: var(--muted); margin-top:2px">${opt}</div>
              </div>
            </label>
          `).join("")}
        </div>

        <div style="margin-top:12px">
          <div class="qmeta">Short justification (required)</div>
          <textarea data-note="${idx}" placeholder="Explain why this is the best action. Keep it brief, but specific.">${answers[idx]?.note || ""}</textarea>
        </div>
      `;

      card.querySelectorAll(`input[name="q${idx}"]`).forEach(r => {
        r.addEventListener("change", (e) => {
          answers[idx] = answers[idx] || {choice: null, note: ""};
          answers[idx].choice = Number(e.target.value);
          saveAnswers();
        });
      });

      card.querySelectorAll(`textarea[data-note="${idx}"]`).forEach(t => {
        t.addEventListener("input", (e) => {
          answers[idx] = answers[idx] || {choice: null, note: ""};
          answers[idx].note = e.target.value;
          saveAnswers();
        });
      });

      examEl.appendChild(card);
    });

    if(window.lucide) window.lucide.createIcons();
    updateProgress();
  }

  function grade(){
    let correct = 0;
    let answered = 0;
    let missingNotes = 0;

    QUESTIONS.forEach((q, idx) => {
      const a = answers[idx];
      if(a && typeof a.choice === "number"){
        answered++;
        if(a.choice === q.correct) correct++;
      }
      if(!a || !a.note || a.note.trim().length < 12) missingNotes++;
    });

    const score = correct / QUESTIONS.length;
    return {correct, answered, score, missingNotes};
  }

  function loadAttempts(){
    const raw = localStorage.getItem(LS_ATTEMPTS);
    return raw ? JSON.parse(raw) : [];
  }
  function saveAttempts(list){
    localStorage.setItem(LS_ATTEMPTS, JSON.stringify(list));
  }

  // Submit
  document.getElementById("submitExam").addEventListener("click", () => {
    const name = traineeName.value.trim();
    if(!name){
      resultEl.innerHTML = `<span class="pill bad"><i data-lucide="alert-circle" style="width:14px;height:14px"></i>Enter your name before submitting.</span>`;
      if(window.lucide) window.lucide.createIcons();
      return;
    }

    const g = grade();
    if(g.answered < QUESTIONS.length){
      resultEl.innerHTML = `<span class="pill warn"><i data-lucide="clipboard-list" style="width:14px;height:14px"></i>Please answer all questions before submitting (${g.answered}/${QUESTIONS.length}).</span>`;
      if(window.lucide) window.lucide.createIcons();
      return;
    }
    if(g.missingNotes > 0){
      resultEl.innerHTML = `<span class="pill warn"><i data-lucide="message-square-warning" style="width:14px;height:14px"></i>${g.missingNotes} question(s) need a longer justification (12+ chars).</span>`;
      if(window.lucide) window.lucide.createIcons();
      return;
    }

    const passed = g.score >= PASSING;
    const attempts = loadAttempts();
    attempts.unshift({
      name,
      score: Math.round(g.score * 100),
      correct: g.correct,
      total: QUESTIONS.length,
      passed,
      ts: new Date().toISOString(),
      answers
    });
    saveAttempts(attempts);

    resultEl.innerHTML = `
      <div class="card" style="grid-column: span 12">
        <div class="hd">
          <div class="left">
            <div class="iconbox" style="background:${passed ? "rgba(52,211,153,.12)" : "rgba(251,113,133,.12)"};border-color:${passed ? "rgba(52,211,153,.22)" : "rgba(251,113,133,.22)"}">
              <i data-lucide="${passed ? "badge-check" : "shield-alert"}"></i>
            </div>
            <div>
              <h3>${passed ? "Passed" : "Not passed"}</h3>
              <p>${name} • ${Math.round(g.score*100)}% (${g.correct}/${QUESTIONS.length})</p>
            </div>
          </div>
          <span class="pill ${passed ? "good":"bad"}"><i data-lucide="${passed ? "check":"x"}" style="width:14px;height:14px"></i>${passed ? "Certified":"Retry required"}</span>
        </div>
        <p class="muted">Attempt saved. Admin can review your answers + justifications.</p>
      </div>
    `;
    if(window.lucide) window.lucide.createIcons();
  });

  // Reset
  document.getElementById("resetExam").addEventListener("click", () => {
    answers = {};
    localStorage.removeItem(LS_ANSWERS);
    resultEl.innerHTML = `<span class="pill"><i data-lucide="rotate-ccw" style="width:14px;height:14px"></i>Answers cleared.</span>`;
    render();
  });

  // Admin modal
  const modal = document.getElementById("adminModal");
  const openAdmin = document.getElementById("openAdmin");
  const closeAdmin = document.getElementById("closeAdmin");
  const adminLogin = document.getElementById("adminLogin");
  const adminPass = document.getElementById("adminPass");
  const adminStatus = document.getElementById("adminStatus");
  const adminBody = document.getElementById("adminBody");
  let unlocked = false;
  let currentTab = "attempts";

  function setAdminStatus(text, icon, cls){
    adminStatus.className = "pill " + (cls || "");
    adminStatus.innerHTML = `<i data-lucide="${icon}" style="width:14px;height:14px"></i>${text}`;
    if(window.lucide) window.lucide.createIcons();
  }

  function fmt(ts){
    const d = new Date(ts);
    return d.toLocaleString();
  }

  function renderAdmin(){
    if(!unlocked){
      adminBody.innerHTML = `<div class="card" style="grid-column: span 12"><p class="muted">Locked. Enter password to view attempts and questions.</p></div>`;
      return;
    }

    const attempts = loadAttempts();

    if(currentTab === "attempts"){
      adminBody.innerHTML = `
        <div class="bar">
          <button class="btn" id="clearLogs"><i data-lucide="trash-2"></i>Clear Logs</button>
          <span class="pill"><i data-lucide="database" style="width:14px;height:14px"></i>${attempts.length} attempt(s)</span>
        </div>

        <div style="margin-top:12px; overflow:auto; border-radius:16px">
          <table class="table">
            <thead>
              <tr>
                <th>Name</th><th>Score</th><th>Result</th><th>Time</th>
              </tr>
            </thead>
            <tbody>
              ${attempts.map((a,i)=>`
                <tr>
                  <td style="color:rgba(238,240,255,.88);font-weight:800">${a.name}</td>
                  <td>${a.score}% (${a.correct}/${a.total})</td>
                  <td>${a.passed ? `<span class="pill good"><i data-lucide="check" style="width:14px;height:14px"></i>Pass</span>` : `<span class="pill bad"><i data-lucide="x" style="width:14px;height:14px"></i>Fail</span>`}</td>
                  <td>${fmt(a.ts)}</td>
                </tr>
              `).join("") || `<tr><td colspan="4">No attempts yet.</td></tr>`}
            </tbody>
          </table>
        </div>
        <div class="muted" style="margin-top:10px;font-size:12px">Note: stored locally in this browser (localStorage). For real cross-device logging, you’d connect to a database.</div>
      `;
      const clear = adminBody.querySelector("#clearLogs");
      if(clear){
        clear.addEventListener("click", ()=>{
          localStorage.removeItem(LS_ATTEMPTS);
          renderAdmin();
        });
      }
    }

    if(currentTab === "questions"){
      adminBody.innerHTML = `
        <div class="card" style="grid-column: span 12">
          <div class="hd">
            <div class="left">
              <div class="iconbox"><i data-lucide="list-checks"></i></div>
              <div>
                <h3>Question bank</h3>
                <p>${QUESTIONS.length} scenario questions • correct answers hidden from trainees.</p>
              </div>
            </div>
          </div>
          <div style="display:grid;gap:10px;margin-top:10px">
            ${QUESTIONS.map((q,i)=>`
              <div style="padding:12px;border-radius:16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10)">
                <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
                  <div style="font-weight:900">${i+1}. ${q.title}</div>
                  <span class="pill"><i data-lucide="tag" style="width:14px;height:14px"></i>${q.meta}</span>
                </div>
                <div class="muted" style="margin-top:6px">${q.q}</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
    }

    if(currentTab === "export"){
      adminBody.innerHTML = `
        <div class="card" style="grid-column: span 12">
          <div class="hd">
            <div class="left">
              <div class="iconbox"><i data-lucide="download"></i></div>
              <div>
                <h3>Export attempts (JSON)</h3>
                <p>Copy and paste this into a secure staff log if needed.</p>
              </div>
            </div>
          </div>
          <textarea readonly style="min-height:220px">${JSON.stringify(loadAttempts(), null, 2)}</textarea>
        </div>
      `;
    }

    if(window.lucide) window.lucide.createIcons();
  }

  openAdmin.addEventListener("click", ()=>{
    modal.classList.add("show");
    modal.setAttribute("aria-hidden","false");
    renderAdmin();
  });
  closeAdmin.addEventListener("click", ()=>{
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden","true");
  });
  modal.addEventListener("click", (e)=>{
    if(e.target === modal){
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden","true");
    }
  });

  adminLogin.addEventListener("click", ()=>{
    if(adminPass.value === ADMIN_PASSWORD){
      unlocked = true;
      setAdminStatus("Unlocked", "unlock", "good");
      renderAdmin();
    }else{
      unlocked = false;
      setAdminStatus("Wrong password", "shield-alert", "bad");
      renderAdmin();
    }
  });

  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      currentTab = t.getAttribute("data-tab");
      renderAdmin();
    });
  });

  render();
})();
</script>
</body>
</html>
